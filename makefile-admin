# -*- Makefile -*-

# ssh -t karney,geographiclib@shell.sourceforge.net create
# git: /home/git/p/geographiclib/code.git

USER=karney
STAGE=$(HOME)/web
WEBSTAGE=$(STAGE)/geographiclib-web
DATASTAGE=$(STAGE)/geographiclib-files
SCRIPTSTAGE=$(WEBSTAGE)/htdocs/scripts

all:
	@echo use prep or distrib-files as targets

prep:
	rm -rf BUILD-release
	cmake -B BUILD-release -S .
	make -C BUILD-release package test
	cp -p BUILD-release/dist/geographiclib*`grep '^Version:' BUILD-release/DESCRIPTION | cut -f2 -d' '`.{zip,tar.gz} distrib-Octave/

distrib-files:
	chmod -R go-w distrib-Octave
	rsync -av --exclude .svn --exclude '.git*' --delete distrib-Octave $(DATASTAGE)/
	rsync --exclude '*~' --exclude '#*' --exclude '.#*' --exclude .svn --exclude '.git*' --delete --delete-excluded -av -e ssh $(DATASTAGE)/distrib-Octave $(USER)@frs.sourceforge.net:/home/frs/project/geographiclib/
